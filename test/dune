(executable
 (name test_js)
 (modes
  (byte js))
 (modules test_js)
 (libraries binaryen.virtual binaryen.js)
 (js_of_ocaml
  (flags --no-sourcemap)))

(test
 (name test)
 (modes
  (best exe))
 (modules test)
 (libraries binaryen.virtual binaryen)
 (action
  (run %{test})))

(rule
 (alias runtest)
 (deps
  (:exe test.exe)
  (:js test_js.bc.js))
 (action
  (progn
   (run %{exe})
   (run node %{js}))))
